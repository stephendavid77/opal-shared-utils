# The active build profile. Set this to one of the profiles defined below (e.g., "ios", "android").
active_profile: "ios"

# ----------------------------------------------------------------------------------------
# Build Profiles
#
# Each profile defines a complete build environment, including the base directory to scan,
# project filtering rules, and build priorities.
# ----------------------------------------------------------------------------------------
build_profiles:
  ios:
    base_directory: "YOUR_IOS_PROJECTS_DIR"
    include_names: "ios_app"
    exclude_names: ""
    include_pattern: ".*"
    exclude_pattern: ".*test.*"
    build_priority: ""
    # Content from buildpilot_ios.yaml
    repo_configurations:
      - repo_name: "ios_app" # Optional: for a specific repository
        builds:
          - directory: "."
            commands:
              - "git reset --hard"
              - "git fetch"
              - "git checkout master"
              - "git pull origin master"
          - directory: "HostApp"
            commands:
              - "export GIT_SSL_NO_VERIFY=true"
              - "pod repo remove gitlab-macys-mobile-ios-podspecs"
              - "pod repo update fds-mobile-ios-podspecs"
              - "pod cache clean --all"
              - "fastlane install"
          - directory: "BAPP/HostApp"
            commands:
              - "bundle install"
              - "fastlane install"

      - # Default configuration for other iOS repositories
        builds:
          - directory: "." # Assumes build happens at the root
            commands:
              - "git pull origin master"
              - "pod install"

  android:
    base_directory: "YOUR_ANDROID_PROJECTS_DIR"
    include_names: "android-app"
    exclude_names: ""
    include_pattern: ".*"
    exclude_pattern: ""
    build_priority: ""
    # Content from android.yaml
    repo_configurations:
      - # Default configuration for Android repositories
        builds:
          - directory: "."
            commands:
              - "git pull origin master"
              - "./gradlew clean"
              - "./gradlew installDebug"

  services:
    base_directory: "YOUR_SERVICES_PROJECTS_DIR"
    include_names: ""
    exclude_names: "msp-mobile-app-core,mobile-core-xapi"
    include_pattern: ".*mobile.*|.*platform.*"
    exclude_pattern: ".*test.*"
    build_priority: "macys-platform-spring,mobile_xapi_common"
    # Content from services.yaml
    repo_configurations:
      - # Default configuration for all service repositories
        builds:
          - directory: "."
            commands:
              - "git reset --hard"
              - "git pull origin master"
              - "mvn clean"
              - "mvn install -Dmaven.test.skip=true"

  automation:
    base_directory: "YOUR_AUTOMATION_PROJECTS_DIR"
    include_names: "ios-ui-tests"
    exclude_names: ""
    include_pattern: ""
    exclude_pattern: ""
    build_priority: ""
    # Content from automation.yaml
    repo_configurations:
      - repo_name: "ios-ui-tests" # Optional: for a specific repository
        builds:
          - directory: "."
            commands:
              - "git pull origin master"
          - directory: "MCOM"
            commands:
              - "bundler install"
              - "fastlane regenerate_project"
              - "pod install"
          - directory: "BCOM"
            commands:
              - "bundler install"
              - "fastlane regenerate_project"
              - "pod install"

      - # Default configuration for other iOS repositories
        builds:
          - directory: "." # Assumes build happens at the root
            commands:
              - "git pull origin master"
              - "pod install"

  python:
    # Content from buildpilot_python.yaml
    git_command: "git pull origin main"
    build_commands:
      - "pip install -r requirements.txt"
      - "python setup.py install"
    indicators:
      - "setup.py"
      - "requirements.txt"

  springboot:
    # Content from springboot.yaml
    git_command: "git pull origin master"
    build_commands:
      - "mvn clean"
      - "mvn install -Dmaven.test.skip=true"
    indicators:
      - "pom.xml"
      - "src/main/java"

# --- Global Settings ---

project_overrides:
  xapi:
    build_command: "./custom-spring-boot-build.sh"

git:
  pull_command: "git pull origin master"

logging:
  enabled: true
